# ğŸ”„ Diagrama do Fluxo de DecisÃ£o das MigraÃ§Ãµes

## ğŸ“Š **Fluxo de DecisÃ£o das MigraÃ§Ãµes**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INÃCIO DA APLICAÃ‡ÃƒO                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CARREGAR CONFIGURAÃ‡Ã•ES                            â”‚
â”‚                                                                 â”‚
â”‚  1. Procurar db_config.json                                    â”‚
â”‚  2. Se nÃ£o encontrar, carregar .env                            â”‚
â”‚  3. Se nÃ£o encontrar, usar variÃ¡veis de ambiente               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              VERIFICAR RUN_MIGRATIONS                           â”‚
â”‚                                                                 â”‚
â”‚  RUN_MIGRATIONS estÃ¡ definida?                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
              â”‚               â”‚
              â–¼               â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   SIM (true)    â”‚ â”‚   NÃƒO (false)   â”‚
    â”‚                 â”‚ â”‚                 â”‚
    â”‚ Executar        â”‚ â”‚ Verificar       â”‚
    â”‚ MigraÃ§Ãµes       â”‚ â”‚ APP_ENV         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  APP_ENV = ?    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚               â”‚
                          â–¼               â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  development    â”‚ â”‚   production    â”‚
                â”‚                 â”‚ â”‚                 â”‚
                â”‚ Executar        â”‚ â”‚ NÃƒO Executar    â”‚
                â”‚ MigraÃ§Ãµes       â”‚ â”‚ MigraÃ§Ãµes       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ **LÃ³gica de DecisÃ£o Detalhada**

### **1. Carregamento de ConfiguraÃ§Ã£o**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FONTES DE CONFIGURAÃ‡ÃƒO                      â”‚
â”‚                                                                 â”‚
â”‚  1. db_config.json (Prioridade 1)                              â”‚
â”‚     â””â”€â”€ Carrega configuraÃ§Ãµes do banco                          â”‚
â”‚                                                                 â”‚
â”‚  2. .env (Prioridade 2)                                        â”‚
â”‚     â””â”€â”€ Carrega variÃ¡veis de ambiente                          â”‚
â”‚                                                                 â”‚
â”‚  3. VariÃ¡veis de Sistema (Prioridade 3)                        â”‚
â”‚     â””â”€â”€ Usa variÃ¡veis jÃ¡ definidas no sistema                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. DecisÃ£o de ExecuÃ§Ã£o das MigraÃ§Ãµes**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VERIFICAÃ‡ÃƒO RUN_MIGRATIONS                  â”‚
â”‚                                                                 â”‚
â”‚  RUN_MIGRATIONS estÃ¡ definida?                                 â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚    true     â”‚    â”‚   false     â”‚    â”‚  nÃ£o definida â”‚      â”‚
â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚        â”‚
â”‚  â”‚ Executar    â”‚    â”‚ NÃƒO Executarâ”‚    â”‚ Verificar   â”‚        â”‚
â”‚  â”‚ MigraÃ§Ãµes   â”‚    â”‚ MigraÃ§Ãµes   â”‚    â”‚ APP_ENV     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **3. VerificaÃ§Ã£o do Ambiente**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    VERIFICAÃ‡ÃƒO APP_ENV                         â”‚
â”‚                                                                 â”‚
â”‚  APP_ENV = ?                                                    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ development â”‚    â”‚  production â”‚    â”‚    test     â”‚        â”‚
â”‚  â”‚             â”‚    â”‚             â”‚    â”‚             â”‚        â”‚
â”‚  â”‚ Executar    â”‚    â”‚ NÃƒO Executarâ”‚    â”‚ Executar    â”‚        â”‚
â”‚  â”‚ MigraÃ§Ãµes   â”‚    â”‚ MigraÃ§Ãµes   â”‚    â”‚ MigraÃ§Ãµes   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ **ConfiguraÃ§Ãµes Atuais do Sistema**

### **Arquivo: `.env`**
```bash
DATABASE_URL=postgresql://postgres:MJs119629@192.168.15.9:5432/sgp
RUN_MIGRATIONS=true          # â† EXECUTA MIGRAÃ‡Ã•ES
APP_ENV=development          # â† AMBIENTE DE DESENVOLVIMENTO
RUST_LOG=info
SESSION_TIMEOUT_HOURS=12
CACHE_TTL_SECONDS=300
```

### **Arquivo: `db_config.json`**
```json
{
  "host": "192.168.15.9",
  "port": "5432",
  "user": "postgres",
  "password": "MJs119629",
  "database": "sgp"
}
```

## ğŸ“Š **Resultado da ConfiguraÃ§Ã£o Atual**

### **Fluxo de DecisÃ£o:**
1. **Carrega configuraÃ§Ã£o**: `.env` encontrado âœ…
2. **Verifica RUN_MIGRATIONS**: `true` âœ…
3. **DecisÃ£o**: **EXECUTAR MIGRAÃ‡Ã•ES** âœ…

### **Por que Executa MigraÃ§Ãµes:**
- **`RUN_MIGRATIONS=true`** estÃ¡ definido explicitamente
- **`APP_ENV=development`** (ambiente de desenvolvimento)
- **ConfiguraÃ§Ã£o vÃ¡lida** encontrada

## ğŸ¯ **Como Alterar o Comportamento**

### **Para NÃƒO Executar MigraÃ§Ãµes:**
```bash
# OpÃ§Ã£o 1: Alterar .env
RUN_MIGRATIONS=false

# OpÃ§Ã£o 2: Alterar ambiente
APP_ENV=production

# OpÃ§Ã£o 3: Remover variÃ¡vel (usa padrÃ£o do ambiente)
# Comentar ou remover a linha RUN_MIGRATIONS
```

### **Para Executar MigraÃ§Ãµes:**
```bash
# OpÃ§Ã£o 1: Alterar .env
RUN_MIGRATIONS=true

# OpÃ§Ã£o 2: Alterar ambiente
APP_ENV=development

# OpÃ§Ã£o 3: Manter configuraÃ§Ã£o atual (jÃ¡ executa)
```

## ğŸš€ **ConclusÃ£o**

### **O Sistema Executa MigraÃ§Ãµes Porque:**

1. **âœ… `RUN_MIGRATIONS=true`** estÃ¡ definido no `.env`
2. **âœ… `APP_ENV=development`** (ambiente de desenvolvimento)
3. **âœ… ConfiguraÃ§Ã£o vÃ¡lida** encontrada
4. **âœ… LÃ³gica de decisÃ£o** determina execuÃ§Ã£o

### **ConfiguraÃ§Ã£o Atual:**
- **Status**: **EXECUTA MIGRAÃ‡Ã•ES** ğŸš€
- **Motivo**: `RUN_MIGRATIONS=true` + `APP_ENV=development`
- **Resultado**: MigraÃ§Ãµes sÃ£o executadas automaticamente na inicializaÃ§Ã£o

**O sistema estÃ¡ configurado para executar migraÃ§Ãµes automaticamente!** ğŸ‰
