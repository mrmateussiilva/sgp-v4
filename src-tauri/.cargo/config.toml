# ==========================================================
# SGP v4 – Configuração de Build SEGURA para distribuição
# Compatível com Windows 10 e Windows 11
# Evita crash: 0xc000001d (Illegal Instruction)
# ==========================================================

# -----------------------------
# Perfil de release (otimizado)
# -----------------------------
[profile.release]
opt-level = 3
lto = "thin"          # LTO seguro (não propaga instruções ilegais)
codegen-units = 1
panic = "abort"
strip = true
debug = false

# -----------------------------------
# Otimização uniforme por dependência
# -----------------------------------
[profile.release.package."*"]
opt-level = 3

[profile.release.package.sqlx]
opt-level = 3

[profile.release.package.tokio]
opt-level = 3

[profile.release.package.serde]
opt-level = 3

# -----------------------------
# Configuração CRÍTICA de build
# -----------------------------
[build]
rustflags = [
  "-C", "target-cpu=x86-64",
  "-C", "target-feature=-avx,-avx2,-sse4.1,-sse4.2,-fma"
]
